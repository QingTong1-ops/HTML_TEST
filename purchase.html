<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智能采购管理系统</title>

  <!-- 关键CSS内联加载避免阻塞渲染 -->
  <style>
    /* 核心样式 */
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --success-color: #06d6a0;
      --warning-color: #ffd166;
      --danger-color: #ef476f;
      --light-bg: #f8f9fa;
    }

    body {
      background: var(--light-bg);
      font-family: 'Segoe UI', system-ui;
      opacity: 0; /* 初始隐藏内容 */
      transition: opacity 0.5s ease;
    }

    .main-container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 1.5rem;
    }

    /* 骨架屏样式 */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 4px;
    }

    .skeleton-text {
      height: 1em;
      margin-bottom: 0.5em;
    }

    .skeleton-table-row td {
      padding: 1rem !important;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* 其他样式 */
    .nav-pills {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .nav-link {
      border-radius: 8px;
      transition: all 0.3s ease;
      color: #64748b;
    }

    .nav-link.active {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white !important;
    }

    .card-module {
      background: white;
      border: none;
      border-radius: 16px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .card-module:hover {
      transform: translateY(-5px);
    }

    .form-control {
      border-radius: 8px;
      padding: 0.75rem 1.25rem;
    }

    .table-module {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .status-badge {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .btn-gradient {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 8px;
    }

    .timeline {
      position: relative;
      padding-left: 30px;
    }
    .timeline-item {
      position: relative;
      padding-bottom: 20px;
    }
    .timeline-icon {
      position: absolute;
      left: -38px;
      top: 0;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .timeline-content {
      border-left: 2px solid #eee;
      padding-left: 20px;
      padding-bottom: 15px;
    }
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .star-rating {
      font-size: 0.9em;
    }

    /* 状态筛选按钮激活样式 */
    .btn[data-status].active {
      background: var(--primary-color);
      color: white !important;
    }

    /* 模态框动画 */
    .modal {
      animation: modalSlide 0.3s ease;
    }

    @keyframes modalSlide {
      from { transform: translateY(20%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* 操作按钮过渡效果 */
    .btn {
      transition: all 0.2s ease;
    }

    .btn-success:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 6px rgba(67, 97, 238, 0.2);
    }

    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .page-item {
      margin: 0 5px;
    }

    .page-link {
      border-radius: 8px;
      padding: 5px 15px;
    }

    .loader {
      text-align: center;
      padding: 20px;
      color: var(--primary-color);
    }

    /* 新增样式 */
    .attribute-item {
      position: relative;
      padding-right: 40px;
    }

    .remove-attribute {
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--danger-color);
    }

    .modal-header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border-radius: 16px 16px 0 0 !important;
    }

    .modal-content {
      border-radius: 16px !important;
      border: none;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1050;
      min-width: 250px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }

    .goods-list-container {
      margin-top: 2rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .highlight {
      background-color: rgba(67, 97, 238, 0.1);
      transition: background-color 0.3s;
    }

    .search-highlight {
      background-color: #ffd166;
    }
  </style>

  <!-- 非关键CSS异步加载 -->
  <link rel="preload" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  </noscript>
</head>

<body>
<!-- 骨架屏 - 初始显示 -->
<div id="skeleton" style="min-height: 100vh; padding: 20px;">
  <div class="main-container">
    <div class="d-flex align-items-center mb-5">
      <div class="skeleton" style="width: 300px; height: 50px;"></div>
    </div>

    <!-- 导航骨架 -->
    <div class="d-flex mb-4">
      <div class="skeleton" style="width: 100px; height: 40px; margin-right: 10px;"></div>
      <div class="skeleton" style="width: 100px; height: 40px; margin-right: 10px;"></div>
      <div class="skeleton" style="width: 100px; height: 40px; margin-right: 10px;"></div>
      <div class="skeleton" style="width: 100px; height: 40px;"></div>
    </div>

    <!-- 内容区域骨架 -->
    <div class="row">
      <div class="col-md-8">
        <div class="skeleton" style="height: 400px; border-radius: 16px;"></div>
      </div>
      <div class="col-md-4">
        <div class="skeleton" style="height: 200px; border-radius: 16px; margin-bottom: 20px;"></div>
        <div class="skeleton" style="height: 200px; border-radius: 16px;"></div>
      </div>
    </div>
  </div>
</div>

<!-- 实际内容 - 初始隐藏 -->
<div id="app" style="display: none;">
  <!-- 提示消息容器 -->
  <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

  <!-- 订单详情模态框 -->
  <div class="modal fade" id="orderModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="orderModalTitle">采购订单详情</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label text-secondary">订单编号</label>
              <input type="text" class="form-control" id="modalOrderId" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label text-secondary">供应商</label>
              <input type="text" class="form-control" id="modalSupplier" readonly>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label text-secondary">订单金额</label>
              <input type="text" class="form-control" id="modalAmount" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label text-secondary">订单状态</label>
              <select class="form-select" id="modalStatus">
                <option value="pending">待审批</option>
                <option value="approved">已通过</option>
                <option value="rejected">已拒绝</option>
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label text-secondary">订单商品</label>
            <table class="table table-sm">
              <thead>
              <tr>
                <th>商品名称</th>
                <th>数量</th>
                <th>单价</th>
                <th>总价</th>
              </tr>
              </thead>
              <tbody id="orderItems">
              <!-- 动态填充 -->
              </tbody>
            </table>
          </div>

          <div class="mb-3">
            <label class="form-label text-secondary">备注</label>
            <textarea class="form-control" id="modalNotes" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
          <button type="button" class="btn btn-gradient" id="saveOrderBtn">保存更改</button>
        </div>
      </div>
    </div>
  </div>

  <div class="main-container">
    <div class="d-flex align-items-center mb-5">
      <h1 class="me-4" style="color: var(--primary-color);">
        <i class="fas fa-boxes me-2"></i>采购管理系统
      </h1>
    </div>

    <!-- 导航菜单 -->
    <ul class="nav nav-pills mb-4">
      <li class="nav-item me-2">
        <a class="nav-link active" data-bs-toggle="tab" href="#goods">
          <i class="fas fa-cube me-2"></i>商品管理
        </a>
      </li>
      <li class="nav-item me-2">
        <a class="nav-link" data-bs-toggle="tab" href="#purchase">
          <i class="fas fa-shopping-cart me-2"></i>采购管理
        </a>
      </li>
      <li class="nav-item me-2">
        <a class="nav-link" data-bs-toggle="tab" href="#inventory">
          <i class="fas fa-warehouse me-2"></i>库存管理
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#supplier">
          <i class="fas fa-handshake me-2"></i>供应商
        </a>
      </li>
    </ul>

    <div class="tab-content">
      <!-- 商品管理 -->
      <div class="tab-pane fade show active" id="goods">
        <div class="card-module p-4 mb-4">
          <h4 class="mb-4"><i class="fas fa-plus-circle me-2"></i>新建商品</h4>
          <form id="goodsForm" class="row g-4">
            <div class="col-md-6">
              <label class="form-label text-secondary">商品名称</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-tag"></i></span>
                <input type="text" id="goodsName" class="form-control" placeholder="输入商品名称" required>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label text-secondary">商品分类</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-layer-group"></i></span>
                <select id="goodsCategory" class="form-select" required>
                  <option value="">选择分类</option>
                  <option value="electronics">电子产品</option>
                  <option value="office">办公用品</option>
                  <option value="tools">工具设备</option>
                  <option value="materials">原材料</option>
                </select>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <label class="form-label text-secondary">商品属性</label>
                <button type="button" class="btn btn-sm btn-gradient" id="addAttributeBtn">
                  <i class="fas fa-plus me-2"></i>添加属性
                </button>
              </div>
              <div id="attributesContainer" class="row g-3">
                <!-- 属性项会动态添加 -->
              </div>
            </div>
            <div class="col-12 text-end">
              <button type="submit" class="btn btn-gradient px-5">
                <i class="fas fa-save me-2"></i>保存商品
              </button>
            </div>
          </form>
        </div>

        <!-- 商品列表 -->
        <div class="card-module p-4">
          <h4 class="mb-4"><i class="fas fa-list me-2"></i>商品列表</h4>
          <div class="table-responsive">
            <table class="table table-module table-hover align-middle">
              <thead class="bg-light">
              <tr>
                <th>商品名称</th>
                <th>分类</th>
                <th>属性</th>
                <th>操作</th>
              </tr>
              </thead>
              <tbody id="goodsList">
              <!-- 商品列表会动态填充 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- 采购管理 -->
      <div class="tab-pane fade" id="purchase">
        <div class="row g-4">
          <div class="col-lg-8">
            <div class="card-module p-4">
              <h4 class="mb-4"><i class="fas fa-file-invoice me-2"></i>采购订单</h4>

              <!-- 骨架屏 -->
              <div id="purchaseSkeleton">
                <div class="d-flex justify-content-between mb-4">
                  <div class="skeleton skeleton-text" style="width: 150px; height: 40px;"></div>
                  <div class="skeleton" style="width: 100px; height: 40px;"></div>
                </div>

                <table class="table table-module">
                  <thead>
                  <tr>
                    <th><div class="skeleton skeleton-text"></div></th>
                    <th><div class="skeleton skeleton-text"></div></th>
                    <th><div class="skeleton skeleton-text"></div></th>
                    <th><div class="skeleton skeleton-text"></div></th>
                    <th><div class="skeleton skeleton-text"></div></th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr class="skeleton-table-row">
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                  </tr>
                  <tr class="skeleton-table-row">
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                    <td><div class="skeleton skeleton-text"></div></td>
                  </tr>
                  </tbody>
                </table>
              </div>

              <div id="purchaseContent" class="d-none">
                <!-- 订单状态筛选 -->
                <div class="d-flex mb-4">
                  <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary active" data-status="all">
                      全部订单
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-status="pending">
                      待审批
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-status="approved">
                      已通过
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-status="rejected">
                      已拒绝
                    </button>
                  </div>
                </div>

                <div class="table-responsive">
                  <table class="table table-module table-hover align-middle">
                    <thead class="bg-light">
                    <tr>
                      <th>订单编号</th>
                      <th>供应商</th>
                      <th>金额</th>
                      <th>状态</th>
                      <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="purchaseTableBody">
                    <!-- 动态加载 -->
                    </tbody>
                  </table>

                  <!-- 分页控件 -->
                  <div id="purchasePagination" class="pagination"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="card-module p-4">
              <h4 class="mb-4"><i class="fas fa-chart-line me-2"></i>采购统计</h4>
              <div class="d-flex justify-content-between mb-3">
                <div class="text-center">
                  <div class="text-secondary small">本月采购</div>
                  <div class="h4 text-primary">¥23,500</div>
                </div>
                <div class="text-center">
                  <div class="text-secondary small">供应商数量</div>
                  <div class="h4 text-success">15</div>
                </div>
              </div>
              <canvas id="purchaseChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- 库存管理 -->
      <div class="tab-pane fade" id="inventory">
        <div class="row g-4">
          <!-- 库存查询 -->
          <div class="col-lg-8">
            <div class="card-module p-4">
              <h4 class="mb-4"><i class="fas fa-search me-2"></i>库存查询</h4>
              <div class="input-group mb-4">
                <input type="text" id="inventorySearch" class="form-control" placeholder="输入商品名称/编码">
                <button class="btn btn-gradient" id="searchInventoryBtn">
                  <i class="fas fa-search me-2"></i>搜索
                </button>
              </div>
              <div class="table-responsive">
                <table class="table table-module table-hover">
                  <thead class="bg-light">
                  <tr>
                    <th>商品名称</th>
                    <th>仓库</th>
                    <th>当前库存</th>
                    <th>安全库存</th>
                    <th>状态</th>
                  </tr>
                  </thead>
                  <tbody id="inventoryTableBody">
                  <!-- 库存数据会动态填充 -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- 库存操作 -->
          <div class="col-lg-4">
            <div class="card-module p-4 mb-4">
              <h4 class="mb-4"><i class="fas fa-exchange-alt me-2"></i>库存调拨</h4>
              <form id="transferForm">
                <div class="mb-3">
                  <label class="form-label text-secondary">选择商品</label>
                  <select class="form-select" id="transferGoods" required>
                    <option value="">请选择商品</option>
                    <!-- 动态填充 -->
                  </select>
                </div>
                <div class="row g-3 mb-3">
                  <div class="col-6">
                    <label class="form-label text-secondary">来源仓库</label>
                    <select class="form-select" id="fromWarehouse" required>
                      <option value="">请选择</option>
                      <option value="shanghai">上海主仓</option>
                      <option value="beijing">北京分仓</option>
                      <option value="guangzhou">广州分仓</option>
                    </select>
                  </div>
                  <div class="col-6">
                    <label class="form-label text-secondary">目标仓库</label>
                    <select class="form-select" id="toWarehouse" required>
                      <option value="">请选择</option>
                      <option value="shanghai">上海主仓</option>
                      <option value="beijing">北京分仓</option>
                      <option value="guangzhou">广州分仓</option>
                    </select>
                  </div>
                </div>
                <div class="mb-4">
                  <label class="form-label text-secondary">调拨数量</label>
                  <input type="number" class="form-control" id="transferQuantity" min="1" value="10" required>
                </div>
                <button type="submit" class="btn btn-gradient w-100">
                  <i class="fas fa-truck-moving me-2"></i>提交调拨
                </button>
              </form>
            </div>

            <div class="card-module p-4">
              <h4 class="mb-4"><i class="fas fa-clipboard-list me-2"></i>近期盘点</h4>
              <div class="timeline">
                <div class="timeline-item">
                  <div class="timeline-icon bg-success">
                    <i class="fas fa-check"></i>
                  </div>
                  <div class="timeline-content">
                    <span class="small text-secondary">2023-09-05</span>
                    <p class="mb-0">上海主仓月度盘点完成</p>
                  </div>
                </div>
                <div class="timeline-item">
                  <div class="timeline-icon bg-warning">
                    <i class="fas fa-exclamation"></i>
                  </div>
                  <div class="timeline-content">
                    <span class="small text-secondary">2023-09-03</span>
                    <p class="mb-0">北京分仓发现差异：-5件</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 供应商管理 -->
      <div class="tab-pane fade" id="supplier">
        <div class="row g-4">
          <!-- 供应商列表 -->
          <div class="col-lg-8">
            <div class="card-module p-4">
              <h4 class="mb-4"><i class="fas fa-handshake me-2"></i>供应商列表</h4>
              <div class="table-responsive">
                <table class="table table-module table-hover">
                  <thead class="bg-light">
                  <tr>
                    <th>供应商名称</th>
                    <th>合作状态</th>
                    <th>信用评级</th>
                    <th>最近交易</th>
                    <th>操作</th>
                  </tr>
                  </thead>
                  <tbody id="supplierTableBody">
                  <!-- 供应商数据会动态填充 -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- 供应商详情 -->
          <div class="col-lg-4">
            <div class="card-module p-4">
              <h4 class="mb-4"><i class="fas fa-info-circle me-2"></i>供应商详情</h4>
              <form id="supplierForm">
                <div class="mb-3">
                  <label class="form-label text-secondary">供应商名称</label>
                  <select class="form-select" id="supplierSelect" required>
                    <option value="">请选择供应商</option>
                    <!-- 动态填充 -->
                  </select>
                </div>
                <div class="row g-3 mb-3">
                  <div class="col-6">
                    <label class="form-label text-secondary">信用等级</label>
                    <select class="form-select" id="supplierCredit" required>
                      <option value="">请选择</option>
                      <option value="AAA">AAA</option>
                      <option value="AA">AA</option>
                      <option value="A">A</option>
                      <option value="B">B</option>
                      <option value="C">C</option>
                    </select>
                  </div>
                  <div class="col-6">
                    <label class="form-label text-secondary">合作状态</label>
                    <select class="form-select" id="supplierStatus" required>
                      <option value="">请选择</option>
                      <option value="active">合作中</option>
                      <option value="paused">已暂停</option>
                      <option value="terminated">终止合作</option>
                    </select>
                  </div>
                </div>
                <div class="mb-4">
                  <label class="form-label text-secondary">最近评价</label>
                  <textarea class="form-control" id="supplierReview" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-gradient w-100">
                  <i class="fas fa-save me-2"></i>更新信息
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 延迟加载JS资源 -->
<script>
  // 数据存储初始化
  function initData() {
    // 商品数据
    if (!localStorage.getItem('procurement_goods')) {
      const initialGoods = [
        { id: 1, name: '笔记本电脑 X1', category: 'electronics', attributes: [{name: '品牌', value: 'ThinkPad'}, {name: '型号', value: 'X1 Carbon'}] },
        { id: 2, name: '无线鼠标 M2', category: 'electronics', attributes: [{name: '品牌', value: 'Logitech'}, {name: '连接方式', value: '蓝牙'}] },
        { id: 3, name: 'A4打印纸', category: 'office', attributes: [{name: '规格', value: '80g'}, {name: '数量', value: '500张/包'}] }
      ];
      localStorage.setItem('procurement_goods', JSON.stringify(initialGoods));
    }

    // 采购订单数据
    if (!localStorage.getItem('procurement_orders')) {
      const initialOrders = [
        { id: 'PO-2309-001', supplier: '科技先锋有限公司', amount: 15000, status: 'pending',
          items: [{name: '笔记本电脑 X1', quantity: 10, price: 1200}, {name: '无线鼠标 M2', quantity: 20, price: 150}] },
        { id: 'PO-2309-002', supplier: '办公用品供应商', amount: 8500, status: 'approved',
          items: [{name: 'A4打印纸', quantity: 100, price: 25}, {name: '文件夹', quantity: 200, price: 3}] },
        { id: 'PO-2309-003', supplier: '工具设备公司', amount: 22000, status: 'pending',
          items: [{name: '电动工具套装', quantity: 5, price: 3500}, {name: '工具箱', quantity: 10, price: 450}] },
        { id: 'PO-2309-004', supplier: '原材料供应商', amount: 12500, status: 'approved',
          items: [{name: '钢材', quantity: 500, price: 25}] },
        { id: 'PO-2309-005', supplier: '科技先锋有限公司', amount: 18000, status: 'rejected',
          items: [{name: '显示器', quantity: 15, price: 1200}] }
      ];
      localStorage.setItem('procurement_orders', JSON.stringify(initialOrders));
    }

    // 库存数据
    if (!localStorage.getItem('procurement_inventory')) {
      const initialInventory = [
        { id: 1, name: '笔记本电脑 X1', warehouse: '上海主仓', current: 150, safety: 200 },
        { id: 1, name: '笔记本电脑 X1', warehouse: '北京分仓', current: 80, safety: 100 },
        { id: 2, name: '无线鼠标 M2', warehouse: '上海主仓', current: 350, safety: 200 },
        { id: 2, name: '无线鼠标 M2', warehouse: '北京分仓', current: 850, safety: 500 },
        { id: 3, name: 'A4打印纸', warehouse: '上海主仓', current: 120, safety: 100 },
        { id: 3, name: 'A4打印纸', warehouse: '广州分仓', current: 200, safety: 150 }
      ];
      localStorage.setItem('procurement_inventory', JSON.stringify(initialInventory));
    }

    // 供应商数据
    if (!localStorage.getItem('procurement_suppliers')) {
      const initialSuppliers = [
        { id: 1, name: '科技先锋有限公司', status: 'active', credit: 'AAA', review: '交货准时，质量稳定',
          contact: '王经理 138-1234-5678', lastTransaction: {date: '2023-09-01', amount: 15000} },
        { id: 2, name: '办公用品供应商', status: 'active', credit: 'AA', review: '价格合理，服务周到',
          contact: '李经理 139-8765-4321', lastTransaction: {date: '2023-08-28', amount: 8500} },
        { id: 3, name: '工具设备公司', status: 'paused', credit: 'A', review: '产品质量好，但发货较慢',
          contact: '张经理 137-1122-3344', lastTransaction: {date: '2023-08-20', amount: 22000} },
        { id: 4, name: '原材料供应商', status: 'active', credit: 'B', review: '价格有优势，但偶尔有质量问题',
          contact: '刘经理 135-5566-7788', lastTransaction: {date: '2023-08-25', amount: 12500} }
      ];
      localStorage.setItem('procurement_suppliers', JSON.stringify(initialSuppliers));
    }
  }

  // 资源加载优化函数
  function loadScript(src, callback) {
    const script = document.createElement('script');
    script.src = src;
    script.async = true;
    script.onload = callback;
    document.body.appendChild(script);
  }

  // 关键渲染路径优化
  window.addEventListener('DOMContentLoaded', function() {
    // 初始化数据
    initData();

    // 加载核心JS资源
    loadScript('https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js', function() {
      loadScript('https://cdn.bootcdn.net/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js', function() {
        // 所有核心资源加载完成后初始化应用
        initApp();
      });
    });
  });

  // 应用初始化
  function initApp() {
    // 隐藏骨架屏，显示实际内容
    document.getElementById('skeleton').style.display = 'none';
    document.getElementById('app').style.display = 'block';

    // 淡入内容
    document.body.style.opacity = 1;

    // 初始化应用逻辑
    initProcurementSystem();
  }

  // 采购系统初始化
  function initProcurementSystem() {
    console.log('采购系统初始化中...');

    // 初始化商品管理
    initGoodsManagement();

    // 初始化采购管理
    initPurchaseManagement();

    // 初始化库存管理
    initInventoryManagement();

    // 初始化供应商管理
    initSupplierManagement();

    // 模拟加载延迟
    setTimeout(function() {
      // 隐藏采购部分的骨架屏
      document.getElementById('purchaseSkeleton').style.display = 'none';
      document.getElementById('purchaseContent').classList.remove('d-none');

      // 加载采购订单数据
      loadPurchaseOrders('all');

      // 延迟加载图表库 - 只在需要时加载
      document.querySelector('[href="#purchase"]').addEventListener('click', function() {
        if (!window.Chart) {
          loadScript('https://cdn.jsdelivr.net/npm/chart.js', function() {
            initPurchaseChart();
          });
        } else if (!window.chartInstance) {
          initPurchaseChart();
        }
      });

      // 如果当前在采购标签页，直接加载图表
      if (document.querySelector('.nav-link.active').getAttribute('href') === '#purchase') {
        loadScript('https://cdn.jsdelivr.net/npm/chart.js', function() {
          initPurchaseChart();
        });
      }
    }, 800); // 模拟800ms数据加载时间
  }

  // 初始化商品管理
  function initGoodsManagement() {
    // 添加属性按钮事件
    document.getElementById('addAttributeBtn').addEventListener('click', addAttribute);

    // 表单提交事件
    document.getElementById('goodsForm').addEventListener('submit', function(e) {
      e.preventDefault();
      saveGoods();
    });

    // 加载商品列表
    loadGoodsList();

    // 初始添加一个属性框
    addAttribute();
  }

  // 添加属性输入框
  function addAttribute() {
    const container = document.getElementById('attributesContainer');
    const attributeId = Date.now(); // 唯一ID

    const attributeDiv = document.createElement('div');
    attributeDiv.className = 'col-md-4 attribute-item';
    attributeDiv.innerHTML = `
      <div class="border p-3 rounded">
        <input type="text" class="form-control mb-2" placeholder="属性名称" required>
        <input type="text" class="form-control" placeholder="属性值" required>
        <div class="remove-attribute">
          <i class="fas fa-times"></i>
        </div>
      </div>
    `;

    container.appendChild(attributeDiv);

    // 添加删除事件
    attributeDiv.querySelector('.remove-attribute').addEventListener('click', function() {
      // 至少保留一个属性框
      if (container.children.length > 1) {
        container.removeChild(attributeDiv);
      } else {
        showToast('至少需要保留一个属性', 'warning');
      }
    });
  }

  // 保存商品
  function saveGoods() {
    const name = document.getElementById('goodsName').value;
    const category = document.getElementById('goodsCategory').value;

    // 收集属性
    const attributes = [];
    const attributeElements = document.querySelectorAll('#attributesContainer .attribute-item');

    attributeElements.forEach(item => {
      const nameInput = item.querySelector('input:first-child');
      const valueInput = item.querySelector('input:last-child');

      if (nameInput.value && valueInput.value) {
        attributes.push({
          name: nameInput.value,
          value: valueInput.value
        });
      }
    });

    // 验证
    if (!name || !category || attributes.length === 0) {
      showToast('请填写完整的商品信息', 'warning');
      return;
    }

    // 创建商品对象
    const newGoods = {
      id: Date.now(), // 使用时间戳作为ID
      name,
      category,
      attributes
    };

    // 保存到本地存储
    const goods = JSON.parse(localStorage.getItem('procurement_goods')) || [];
    goods.push(newGoods);
    localStorage.setItem('procurement_goods', JSON.stringify(goods));

    // 显示成功消息
    showToast(`商品 "${name}" 保存成功`, 'success');

    // 重置表单
    document.getElementById('goodsForm').reset();
    document.getElementById('attributesContainer').innerHTML = '';
    addAttribute(); // 重新添加一个空属性框

    // 更新商品列表
    loadGoodsList();

    // 高亮新添加的商品
    setTimeout(() => {
      const newRow = document.querySelector(`#goodsList tr[data-id="${newGoods.id}"]`);
      if (newRow) {
        newRow.classList.add('highlight');
        setTimeout(() => newRow.classList.remove('highlight'), 3000);
      }
    }, 500);
  }

  // 加载商品列表
  function loadGoodsList() {
    const goodsList = document.getElementById('goodsList');
    goodsList.innerHTML = '';

    const goods = JSON.parse(localStorage.getItem('procurement_goods')) || [];

    if (goods.length === 0) {
      goodsList.innerHTML = '<tr><td colspan="4" class="text-center py-4">暂无商品数据</td></tr>';
      return;
    }

    goods.forEach(good => {
      const attributesHtml = good.attributes.map(attr =>
        `<span class="badge bg-light text-dark me-1">${attr.name}: ${attr.value}</span>`
      ).join('');

      const row = document.createElement('tr');
      row.setAttribute('data-id', good.id);
      row.innerHTML = `
        <td>${good.name}</td>
        <td>${document.querySelector(`#goodsCategory option[value="${good.category}"]`).textContent}</td>
        <td>${attributesHtml}</td>
        <td>
          <button class="btn btn-sm btn-outline-danger delete-goods">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      `;

      goodsList.appendChild(row);
    });

    // 添加删除事件
    document.querySelectorAll('.delete-goods').forEach(btn => {
      btn.addEventListener('click', function() {
        const row = this.closest('tr');
        const goodsId = row.getAttribute('data-id');
        deleteGoods(goodsId);
      });
    });
  }

  // 删除商品
  function deleteGoods(goodsId) {
    const goods = JSON.parse(localStorage.getItem('procurement_goods')) || [];
    const index = goods.findIndex(g => g.id == goodsId);

    if (index !== -1) {
      const goodsName = goods[index].name;
      goods.splice(index, 1);
      localStorage.setItem('procurement_goods', JSON.stringify(goods));
      showToast(`商品 "${goodsName}" 已删除`, 'success');
      loadGoodsList();
    }
  }

  // 初始化采购管理
  function initPurchaseManagement() {
    // 状态筛选按钮事件
    document.querySelectorAll('#purchaseContent .btn[data-status]').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('#purchaseContent .btn[data-status]').forEach(b => {
          b.classList.remove('active');
        });
        this.classList.add('active');
        const status = this.getAttribute('data-status');
        loadPurchaseOrders(status);
      });
    });

    // 保存订单按钮事件
    document.getElementById('saveOrderBtn').addEventListener('click', saveOrderChanges);
  }

  // 加载采购订单
  function loadPurchaseOrders(status = 'all') {
    const orders = JSON.parse(localStorage.getItem('procurement_orders')) || [];
    const tbody = document.getElementById('purchaseTableBody');
    tbody.innerHTML = '';

    // 过滤订单
    const filteredOrders = status === 'all' ?
      orders :
      orders.filter(order => order.status === status);

    if (filteredOrders.length === 0) {
      tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">暂无订单数据</td></tr>';
      return;
    }

    filteredOrders.forEach(order => {
      const statusBadge = order.status === 'pending' ?
        '<span class="status-badge bg-warning text-dark">' +
        '<i class="fas fa-clock me-2"></i>待审批' +
        '</span>' :
        order.status === 'approved' ?
          '<span class="status-badge bg-success text-white">' +
          '<i class="fas fa-check-circle me-2"></i>已通过' +
          '</span>' :
          '<span class="status-badge bg-danger text-white">' +
          '<i class="fas fa-times-circle me-2"></i>已拒绝' +
          '</span>';

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>#${order.id}</td>
        <td>${order.supplier}</td>
        <td class="fw-bold">¥${order.amount.toLocaleString()}</td>
        <td>${statusBadge}</td>
        <td>
          <button class="btn btn-sm btn-outline-primary edit-order" data-id="${order.id}">
            <i class="fas fa-edit"></i>
          </button>
        </td>
      `;
      tbody.appendChild(row);
    });

    // 添加编辑事件
    document.querySelectorAll('.edit-order').forEach(btn => {
      btn.addEventListener('click', function() {
        const orderId = this.getAttribute('data-id');
        openOrderModal(orderId);
      });
    });
  }

  // 打开订单模态框
  function openOrderModal(orderId) {
    const orders = JSON.parse(localStorage.getItem('procurement_orders')) || [];
    const order = orders.find(o => o.id === orderId);

    if (!order) {
      showToast('订单数据未找到', 'danger');
      return;
    }

    // 填充订单数据
    document.getElementById('modalOrderId').value = order.id;
    document.getElementById('modalSupplier').value = order.supplier;
    document.getElementById('modalAmount').value = '¥' + order.amount.toLocaleString();
    document.getElementById('modalStatus').value = order.status;
    document.getElementById('modalNotes').value = order.notes || '';

    // 填充订单商品
    const itemsContainer = document.getElementById('orderItems');
    itemsContainer.innerHTML = '';

    order.items.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.quantity}</td>
        <td>¥${item.price.toLocaleString()}</td>
        <td>¥${(item.quantity * item.price).toLocaleString()}</td>
      `;
      itemsContainer.appendChild(row);
    });

    // 显示模态框
    const orderModal = new bootstrap.Modal(document.getElementById('orderModal'));
    orderModal.show();

    // 存储当前编辑的订单ID
    document.getElementById('saveOrderBtn').setAttribute('data-id', orderId);
  }

  // 保存订单更改
  function saveOrderChanges() {
    const orderId = document.getElementById('saveOrderBtn').getAttribute('data-id');
    const newStatus = document.getElementById('modalStatus').value;

    const orders = JSON.parse(localStorage.getItem('procurement_orders')) || [];
    const orderIndex = orders.findIndex(o => o.id === orderId);

    if (orderIndex === -1) {
      showToast('订单数据未找到', 'danger');
      return;
    }

    // 更新订单状态
    orders[orderIndex].status = newStatus;
    orders[orderIndex].notes = document.getElementById('modalNotes').value;

    // 保存到本地存储
    localStorage.setItem('procurement_orders', JSON.stringify(orders));

    // 显示成功消息
    showToast('订单状态已更新', 'success');

    // 关闭模态框
    const orderModal = bootstrap.Modal.getInstance(document.getElementById('orderModal'));
    orderModal.hide();

    // 重新加载订单列表
    const currentStatus = document.querySelector('#purchaseContent .btn[data-status].active').getAttribute('data-status');
    loadPurchaseOrders(currentStatus);
  }

  // 初始化库存管理
  function initInventoryManagement() {
    // 搜索按钮事件
    document.getElementById('searchInventoryBtn').addEventListener('click', searchInventory);

    // 输入框回车事件
    document.getElementById('inventorySearch').addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        searchInventory();
      }
    });

    // 调拨表单提交事件
    document.getElementById('transferForm').addEventListener('submit', function(e) {
      e.preventDefault();
      submitTransfer();
    });

    // 加载库存数据
    loadInventory();

    // 加载商品选择框
    loadGoodsForTransfer();
  }

  // 加载库存数据
  function loadInventory() {
    const inventory = JSON.parse(localStorage.getItem('procurement_inventory')) || [];
    const tbody = document.getElementById('inventoryTableBody');
    tbody.innerHTML = '';

    if (inventory.length === 0) {
      tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">暂无库存数据</td></tr>';
      return;
    }

    inventory.forEach(item => {
      const status = item.current < item.safety ?
        '<span class="status-badge bg-danger text-white">' +
        '<i class="fas fa-exclamation-triangle me-2"></i>库存不足' +
        '</span>' :
        '<span class="status-badge bg-success text-white">' +
        '<i class="fas fa-check-circle me-2"></i>正常' +
        '</span>';

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.warehouse}</td>
        <td class="fw-bold">${item.current}</td>
        <td>${item.safety}</td>
        <td>${status}</td>
      `;
      tbody.appendChild(row);
    });
  }

  // 搜索库存
  function searchInventory() {
    const keyword = document.getElementById('inventorySearch').value.toLowerCase();
    const inventory = JSON.parse(localStorage.getItem('procurement_inventory')) || [];
    const tbody = document.getElementById('inventoryTableBody');
    tbody.innerHTML = '';

    const filtered = keyword ?
      inventory.filter(item => item.name.toLowerCase().includes(keyword)) :
      inventory;

    if (filtered.length === 0) {
      tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">未找到匹配的库存记录</td></tr>';
      return;
    }

    filtered.forEach(item => {
      const status = item.current < item.safety ?
        '<span class="status-badge bg-danger text-white">' +
        '<i class="fas fa-exclamation-triangle me-2"></i>库存不足' +
        '</span>' :
        '<span class="status-badge bg-success text-white">' +
        '<i class="fas fa-check-circle me-2"></i>正常' +
        '</span>';

      // 高亮匹配的关键词
      const name = keyword ?
        item.name.replace(new RegExp(keyword, 'gi'), match => `<span class="search-highlight">${match}</span>`) :
        item.name;

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${name}</td>
        <td>${item.warehouse}</td>
        <td class="fw-bold">${item.current}</td>
        <td>${item.safety}</td>
        <td>${status}</td>
      `;
      tbody.appendChild(row);
    });
  }

  // 加载商品选择框（用于调拨）
  function loadGoodsForTransfer() {
    const select = document.getElementById('transferGoods');
    const goods = JSON.parse(localStorage.getItem('procurement_goods')) || [];

    // 清除旧选项（保留第一个选项）
    while (select.options.length > 1) {
      select.remove(1);
    }

    // 添加商品选项
    goods.forEach(good => {
      const option = document.createElement('option');
      option.value = good.id;
      option.textContent = good.name;
      select.appendChild(option);
    });
  }

  // 提交调拨
  function submitTransfer() {
    const goodsId = document.getElementById('transferGoods').value;
    const fromWarehouse = document.getElementById('fromWarehouse').value;
    const toWarehouse = document.getElementById('toWarehouse').value;
    const quantity = parseInt(document.getElementById('transferQuantity').value);

    // 验证
    if (!goodsId || !fromWarehouse || !toWarehouse || !quantity || quantity <= 0) {
      showToast('请填写完整的调拨信息', 'warning');
      return;
    }

    if (fromWarehouse === toWarehouse) {
      showToast('来源仓库和目标仓库不能相同', 'warning');
      return;
    }

    // 获取库存数据
    let inventory = JSON.parse(localStorage.getItem('procurement_inventory')) || [];

    // 查找来源仓库库存
    const fromItem = inventory.find(item =>
      item.id == goodsId && item.warehouse === fromWarehouse
    );

    if (!fromItem) {
      showToast('来源仓库没有找到该商品', 'danger');
      return;
    }

    // 检查库存是否足够
    if (fromItem.current < quantity) {
      showToast(`来源仓库库存不足（当前：${fromItem.current}）`, 'danger');
      return;
    }

    // 查找目标仓库库存
    let toItem = inventory.find(item =>
      item.id == goodsId && item.warehouse === toWarehouse
    );

    // 如果目标仓库没有该商品，创建一个新记录
    if (!toItem) {
      const goods = JSON.parse(localStorage.getItem('procurement_goods')) || [];
      const good = goods.find(g => g.id == goodsId);

      if (!good) {
        showToast('商品信息未找到', 'danger');
        return;
      }

      toItem = {
        id: goodsId,
        name: good.name,
        warehouse: toWarehouse,
        current: 0,
        safety: 0 // 安全库存默认为0，需要后续设置
      };

      inventory.push(toItem);
    }

    // 更新库存
    fromItem.current -= quantity;
    toItem.current += quantity;

    // 保存到本地存储
    localStorage.setItem('procurement_inventory', JSON.stringify(inventory));

    // 显示成功消息
    showToast('库存调拨成功', 'success');

    // 重置表单
    document.getElementById('transferForm').reset();

    // 重新加载库存数据
    loadInventory();
  }

  // 初始化供应商管理
  function initSupplierManagement() {
    // 表单提交事件
    document.getElementById('supplierForm').addEventListener('submit', function(e) {
      e.preventDefault();
      updateSupplier();
    });

    // 供应商选择框变更事件
    document.getElementById('supplierSelect').addEventListener('change', function() {
      loadSupplierDetails(this.value);
    });

    // 加载供应商列表
    loadSuppliers();
  }

  // 加载供应商列表
  function loadSuppliers() {
    const suppliers = JSON.parse(localStorage.getItem('procurement_suppliers')) || [];
    const select = document.getElementById('supplierSelect');
    const tbody = document.getElementById('supplierTableBody');

    // 清空选择框（保留第一个选项）
    while (select.options.length > 1) {
      select.remove(1);
    }

    // 清空表格
    tbody.innerHTML = '';

    if (suppliers.length === 0) {
      tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">暂无供应商数据</td></tr>';
      return;
    }

    // 填充选择框和表格
    suppliers.forEach(supplier => {
      // 添加选择框选项
      const option = document.createElement('option');
      option.value = supplier.id;
      option.textContent = supplier.name;
      select.appendChild(option);

      // 添加表格行
      const status = supplier.status === 'active' ?
        '<span class="status-badge bg-success text-white">' +
        '<i class="fas fa-check-circle me-2"></i>合作中' +
        '</span>' :
        supplier.status === 'paused' ?
          '<span class="status-badge bg-warning text-dark">' +
          '<i class="fas fa-pause-circle me-2"></i>已暂停' +
          '</span>' :
          '<span class="status-badge bg-danger text-white">' +
          '<i class="fas fa-ban me-2"></i>终止合作' +
          '</span>';

      const creditStars = {
        'AAA': '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>',
        'AA': '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>',
        'A': '<i class="fas fa-star"></i><i class="fas fa-star"></i>',
        'B': '<i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>',
        'C': '<i class="fas fa-star"></i>'
      };

      const row = document.createElement('tr');
      row.setAttribute('data-id', supplier.id);
      row.innerHTML = `
        <td>
          <div class="d-flex align-items-center">
            <div class="avatar bg-primary text-white me-3">${supplier.name.charAt(0)}</div>
            <div>
              <div class="fw-bold">${supplier.name}</div>
              <div class="small text-secondary">${supplier.contact}</div>
            </div>
          </div>
        </td>
        <td>${status}</td>
        <td>
          <div class="star-rating text-warning">
            ${creditStars[supplier.credit] || supplier.credit}
          </div>
        </td>
        <td>
          <div class="small">${supplier.lastTransaction.date}</div>
          <div class="small text-success">¥${supplier.lastTransaction.amount.toLocaleString()}</div>
        </td>
        <td>
          <button class="btn btn-sm btn-outline-primary select-supplier" data-id="${supplier.id}">
            <i class="fas fa-edit"></i>
          </button>
        </td>
      `;
      tbody.appendChild(row);
    });

    // 添加选择事件
    document.querySelectorAll('.select-supplier').forEach(btn => {
      btn.addEventListener('click', function() {
        const supplierId = this.getAttribute('data-id');
        document.getElementById('supplierSelect').value = supplierId;
        loadSupplierDetails(supplierId);
      });
    });

    // 默认加载第一个供应商
    if (suppliers.length > 0) {
      loadSupplierDetails(suppliers[0].id);
    }
  }

  // 加载供应商详情
  function loadSupplierDetails(supplierId) {
    const suppliers = JSON.parse(localStorage.getItem('procurement_suppliers')) || [];
    const supplier = suppliers.find(s => s.id == supplierId);

    if (!supplier) return;

    // 填充表单
    document.getElementById('supplierCredit').value = supplier.credit;
    document.getElementById('supplierStatus').value = supplier.status;
    document.getElementById('supplierReview').value = supplier.review;
  }

  // 更新供应商信息
  function updateSupplier() {
    const supplierId = document.getElementById('supplierSelect').value;
    const credit = document.getElementById('supplierCredit').value;
    const status = document.getElementById('supplierStatus').value;
    const review = document.getElementById('supplierReview').value;

    // 验证
    if (!supplierId || !credit || !status || !review) {
      showToast('请填写完整的供应商信息', 'warning');
      return;
    }

    // 获取供应商列表
    const suppliers = JSON.parse(localStorage.getItem('procurement_suppliers')) || [];
    const supplierIndex = suppliers.findIndex(s => s.id == supplierId);

    if (supplierIndex === -1) {
      showToast('供应商未找到', 'danger');
      return;
    }

    // 更新供应商信息
    suppliers[supplierIndex].credit = credit;
    suppliers[supplierIndex].status = status;
    suppliers[supplierIndex].review = review;

    // 保存到本地存储
    localStorage.setItem('procurement_suppliers', JSON.stringify(suppliers));

    // 显示成功消息
    showToast('供应商信息已更新', 'success');

    // 重新加载供应商列表
    loadSuppliers();
  }

  // 显示提示消息
  function showToast(message, type = 'success') {
    const toastContainer = document.getElementById('toastContainer');
    const toastId = `toast-${Date.now()}`;

    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type} border-0`;
    toast.setAttribute('role', 'alert');
    toast.setAttribute('aria-live', 'assertive');
    toast.setAttribute('aria-atomic', 'true');
    toast.id = toastId;

    toast.innerHTML = `
      <div class="d-flex">
        <div class="toast-body">${message}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `;

    toastContainer.appendChild(toast);

    // 显示Toast
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();

    // 3秒后自动移除
    setTimeout(() => {
      toast.remove();
    }, 3000);
  }

  // 初始化图表
  function initPurchaseChart() {
    console.log('初始化采购统计图表...');

    // 确保图表容器存在
    const canvas = document.getElementById('purchaseChart');
    if (!canvas) return;

    // 模拟图表数据
    const ctx = canvas.getContext('2d');

    // 简单模拟图表
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;

    // 绘制一个简单的饼图
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = Math.min(centerX, centerY) * 0.8;

    const data = [65, 25, 10]; // 百分比数据
    const colors = ['#4361ee', '#3f37c9', '#ef476f'];
    let startAngle = 0;

    data.forEach((value, index) => {
      const sliceAngle = (value / 100) * 2 * Math.PI;

      // 绘制扇形
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
      ctx.closePath();
      ctx.fillStyle = colors[index];
      ctx.fill();

      startAngle += sliceAngle;
    });

    // 标记为已初始化
    window.chartInstance = true;
  }
</script>
</body>
</html>
